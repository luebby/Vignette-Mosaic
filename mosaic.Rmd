---
title: "Beispielanalysen mit R mosaic"
author: "Sebastian Sauer und Karsten Lübke"
date: ""
output: 
  pdf_document:
    fig_height: 3
    fig_width: 5
editor_options: 
  chunk_output_type: console
---

```{r, setup, include=FALSE}
# Some customization.  You can alter or delete as desired (if you know what you are doing).
knitr::opts_chunk$set(
  size="small")   # slightly smaller font for code
```

# Vorbemerkungen

Dies Vignette dient ausschließlich als Beispielsammlung für die Analyse von Fragestellungen mit `R` `mosaic`. Sie kann und soll kein Lehrbuch für Statistik oder R ersetzen.

# Datenbeschreibung

## Hintergrund

Gibt es Unterschiede bzw. Zusammenhänge zwischen den Persönlichkeitsmerkmal *Gewissenhaftigkeit*, der Selbsteinschätzung der *Kompetenz* für das Fach Statistik, der *Notenerwartung* sowie eines Aspektes des *Wissens* (öknomisch-statistischer Bezug). Als demographische Faktoren werden *Alter* und *Geschlecht* berücksichtigt.

## Studiendesign

- Gelegeneitsstichprobe: freiwillige Online Umfrage vor Semesterbeginn an mehreren FOM Standorten in Vorlesungen mit statistischem Bezug.
- Operationalisierung:
  - *Gewissenhaftigkeit* (`D_BFI_G`): Rammstedt, B., Kemper, C. J., Klein, M. C., Beierlein, C. & Kovaleva, A., (2014). *Big Five Inventory (BFI-10)*. Zusammenstellung sozialwissenschaftlicher Items und Skalen. 
  - *Kompetenz* (`B_SATS_Kompetenz`): Schau, C. (2003), *Survey of Attitudes Toward Statistics (SATS-36)*
  - *Notenerwartung* (`C4_Notenerwartung`): Welche Note erwarten Sie in diesem Kurs?
  - *Wissen*. (`F07_Aktien`): briq-Institut und DIE ZEIT; Altmann, S., Falk, A., Heuser, U.J. & Radbruch, J. (2018). Was wissen die Deutschen über Wirtschaft? 
  
  > Wie sehr stimmen Sie der folgenden Aussage zu: "Die Anlage in Aktien eines einzelnen Unternehmens ist generell weniger riskant als die Anlage in einem Fonds mit Aktien verschiedener Unternehmen".
  

**Hinweis**: Aufgrund des Designs als Gelegeneitsstichprobe in verschiedenen Kursen sind verzerrende Kovariablen, z.B. Studiengang möglich, die Validität der Ergebnisse ist daher eingeschränkt!

Daten einlesen:

```{r}
GKNW <- read.csv2("Datenbasis_SATS_BFI.csv")
```

Vorbereitung:
```{r, message=FALSE}
library(mosaic)
```

Erste Übersicht:
```{r}
inspect(GKNW)
```

# Datenvorverarbeitung

- Richtige Antwort auf `F07_Aktien` markieren
- Alter gruppieren
- Beobachtungen mit fehlende Werte eleminieren

```{r}
GKNW <- GKNW %>%
  mutate(F07_Aktien = case_when(F07_Aktien == "Stimme ganz und gar nicht zu." ~ "richtig",
                                TRUE ~ "falsch")) %>%
  mutate(G02_Alter = cut(G02_Alter, c(18,23,28,33))) %>%
  na.omit() 
```

Anzahl Beobachtungen nach Datenvorverarbeitung:

```{r}
n <- nrow(GKNW)
n
```


# Analyse eines Anteilswertes

## Fragestellung

Wie hoch ist der Anteil derjenigen, die die Wissensfrage richtig beantworten konnten?

## Grafische Analyse

```{r}
gf_bar( ~ F07_Aktien, data = GKNW) %>%
  gf_labs(title="Öknomisches Wissensfrage",
  x="Antwort", y="Häufigkeit") 
```

## Kennzahlen

```{r}
tally( ~ F07_Aktien, data = GKNW)
p_stipro <- prop( ~ F07_Aktien, success = "richtig", data = GKNW)
p_stipro
```

## Inferenz

### Simulationbasiert

Bootstrap-Konfidenzintervall:

```{r}
set.seed(1896)
Bootvtlg <- do(1000) * prop( ~ F07_Aktien, success = "richtig", 
                                           data = resample(GKNW))
gf_histogram( ~ prop_richtig, data = Bootvtlg, bins = 21, center = p_stipro) %>%
  gf_labs(title = "Bootstrap Verteilung Anteil richtig") 
confint(Bootvtlg)
```

Es gab fünf Antwortalternativen, d.h. die für die Rateerfolgswahrscheinlichkeit gilt: $\pi=1/5$, bei $n=`r nrow(GKNW)`$ Beobachtungen.

Einfache Simulation:

```{r}
set.seed(1896)
Nullvtlg <- do(1000) * rflip(n = n, prob = 1/5)
gf_histogram( ~ prop, data = Nullvtlg, bins = 21, center = 1/5) %>%
  gf_labs(title = "Verteilung Anteil richtig im Modell 'Raten'") %>%
  gf_vline(xintercept = ~ p_stipro)
prop( ~ prop >= p_stipro, data = Nullvtlg)
```

### Klassisch

```{r}
binom.test( ~ F07_Aktien, success = "richtig", 
            p = 1/5, alternative = "greater",
            data = GKNW )
```

*Hinweis*: Bei einer gerichteten Hypothese (hier: $H_A: \pi>1/5$) wird das einseitige Konfidenzintervall ausgegben.

## Antwort

- In der Stichprobe liegt der Anteil richtiger Antworten bei $p=`r round(p_stipro, 2)`$.
- Das $95\%$-Konfidenzintervall für $\pi$ überdeckt den Bereich $`r floor(confint(Bootvtlg)$lower*100)/100`$ bis $`r ceiling(confint(Bootvtlg)$upper*100)/100`$.
- Der p-Wert unter $H_0: \pi \leq 1/5$ ist $\leq `r tally( ~ prop >= p_stipro, data = Nullvtlg)[1]+1`/`r nrow(Nullvtlg)`$.


# Analyse eines Mittelwertes

## Fragestellung

Wie hoch ist die Selbsteinschätzung der kognitiven Kompetenz bezüglich des Fachs Statistik?

## Grafische Analyse

```{r}
gf_histogram(~ B_SATS_Kompetenz, data = GKNW,
             center = 4, binwidth = 0.5) %>%
    gf_labs(title="SATS-36",
            x="Kognitive Kompetenz", y="Häufigkeit") 
```

## Kennzahlen

```{r}
favstats(~ B_SATS_Kompetenz, data = GKNW)
```

```{r}
mean_stipro <- mean(~ B_SATS_Kompetenz, data = GKNW)
mean_stipro
sd_stipro <- sd(~ B_SATS_Kompetenz, data = GKNW)
sd_stipro
```

## Inferenz

### Simulationsbasiert

Bootstrap Konfidenzintervall für den Mittelwert:

```{r}
set.seed(1896)
Bootvtlg <- do(1000) * mean(~ B_SATS_Kompetenz, data = resample(GKNW))
gf_histogram( ~ mean, data = Bootvtlg, bins = 21, center = mean_stipro) %>%
  gf_labs(title = "Bootstrap Verteilung Mittelwert") 
confint(Bootvtlg)
```

Der neutrale Wert der 7-er Multi-Item Likert Skala liegt bei $\mu=4$. Zusätzlich: Annahme einer Normalverteilung und Verwendung der geschätzten Standardabweichung $\hat{\sigma} = `r round(sd_stipro, 2)$.

```{r}
set.seed(1896)
Nullvtlg <- do(1000) * mean( ~ rnorm(n = n, mean = 4, sd = sd_stipro))
gf_histogram( ~ mean, data = Nullvtlg, bins = 21, center = 4) %>%
  gf_labs(title = "Verteilung Mittelwert im Modell 'Neutral'") %>%
  gf_vline(xintercept = ~ mean_stipro)
diff_stipro <- abs(mean_stipro - 4)
prop( ~ (abs(mean-4)) >= diff_stipro, data = Nullvtlg)
```

### Klassisch

```{r}
t.test( ~ B_SATS_Kompetenz, data = GKNW, mu=4)
```

## Antwort

- In der Stichprobe liegt der Mittelwert der eingeschätzten Kompetenz bei  $\bar{x}=`r round(mean_stipro, 2)`$ bei einer Standardabweichung von $sd=`r round(sd_stipro, 2)`$.
- Das $95\%$-Konfidenzintervall für $\pi$ überdeckt den Bereich $`r floor(confint(Bootvtlg)$lower*100)/100`$ bis $`r ceiling(confint(Bootvtlg)$upper*100)/100`$.
- Der p-Wert unter $H_0: \mu =4$ ist $\leq `r tally( ~ (abs(mean-4)) >= diff_stipro, data = Nullvtlg)[1]+1`/`r nrow(Nullvtlg)`$.


# Vergleich zweier Anteilswerte

## Fragestellung

Unterscheidet sich der Anteil der richtigen Antworten auf die ökonomische Frage zwischen Männern und Frauen?

## Grafische Analyse

```{r}
gf_bar( ~ F07_Aktien | ~ G01_Geschlecht, data = GKNW)  %>%
  gf_labs(title="Öknomisches Wissensfrage",
  x="Antwort", y="Häufigkeit") 
```

```{r}
gf_bar( ~ G01_Geschlecht, fill = ~ F07_Aktien, position = "fill",
        data = GKNW)  %>%
  gf_labs(title="Öknomisches Wissensfrage",
  x="Geschlecht", y="Anteil richtig/falsch") 
```

## Kennzahlen

```{r}
tally(F07_Aktien ~ G01_Geschlecht, data = GKNW)
tally(F07_Aktien ~ G01_Geschlecht, format = "proportion",
      data = GKNW)
prop_stipro <- prop(F07_Aktien ~ G01_Geschlecht, success = "richtig", data = GKNW)
prop_stipro
diff_stipro <-diffprop(F07_Aktien ~ G01_Geschlecht, success = "richtig", data = GKNW)
diff_stipro
```

## Inferenz

### Simulationsbasiert

Bootstrap Konfidenzintervall:

```{r}
set.seed(1896)
Bootvtlg <- do(1000) * diffprop(F07_Aktien ~ G01_Geschlecht, success = "richtig", 
                                           data = resample(GKNW))
gf_histogram( ~ diffprop, data = Bootvtlg, bins = 21, center = diff_stipro) %>%
  gf_labs(title = "Bootstrap Verteilung Differenz Anteil richtig") 
confint(Bootvtlg)
```

Permutationsverteilung unter $H_0: F_{\text{maennlich}}=F_{\text{weiblich}}$:

```{r}
set.seed(1896)
Nullvtlg <- do(1000) * diffprop(F07_Aktien ~ shuffle(G01_Geschlecht), 
                                success = "richtig", data = GKNW)
gf_histogram( ~ diffprop, data = Nullvtlg, bins = 21, center = 0) %>%
  gf_labs(title = "Permutationsverteilung Differenz Anteil richtig") %>%
  gf_vline(xintercept = ~ diff_stipro)

prop( ~ (abs(diffprop) >= abs(diff_stipro)), data = Nullvtlg)
```

### Klassisch

```{r}
prop.test(F07_Aktien ~ G01_Geschlecht, success = "richtig", data = GKNW)
```

*Hinweis:* Anders als bei `diffprop()` bezieht sich hier das Konfidenzintervall auf $\pi_{\text{maennlich}}-\pi_{\text{weiblich}}$.

## Antwort

**Hinweis**: Neben den Validitätsproblem einer Gelegenheitsstichprobe ist hier zu beachten, dass das öknomische Wissen nur durch eine einzelne finanzwissenschaftliche Fragestellung mit der Forumulierung der richtigen Antwort 

> Stimme ganz und gar nicht zu.

auf einer Likert-Skala Operationalisiert wurde.

- In der Stichprobe liegt der Anteil richtiger Antworten bei $p_{\text{maennlich}}=`r round(p_stipro[1], 2)`$ und $p_{\text{weiblich}}=`r round(p_stipro[2], 2)`$.
- Das $95\%$-Konfidenzintervall für $\pi_{\text{weiblich}}-_{\text{maennlich}}$ überdeckt den Bereich $`r floor(confint(Bootvtlg)$lower*100)/100`$ bis $`r ceiling(confint(Bootvtlg)$upper*100)/100`$.
- Der p-Wert unter $H_0: \pi_{\text{weiblich}}-\pi_{\text{maennlich}}=0 \Leftrightarrow \pi_{\text{weiblich}}=\pi_{\text{maennlich}}$ ist $\leq `r tally( ~ (abs(diffprop) >= abs(diff_stipro)), data = Nullvtlg)[1]+1`/`r nrow(Nullvtlg)`$.


# Vergleich zweier Mittelwerte

# Vergleich von zwei oder mehr Anteilswerten

# Vergleich von zwei oder mehr Mittelwerten

# Lineare Regression

# Logistische Regression




# Versionshinweise

```{r}
sessionInfo()
```


